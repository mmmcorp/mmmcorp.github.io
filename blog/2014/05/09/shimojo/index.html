<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>RuboCopを使ってコーディング規約に沿ったコードを書く | MMMブログ</title>
  <meta name="viewport" content="width=device-width">
  <meta name="description" content="下條です。現在参加しているRailsプロジェクトでは、RuboCopを使ってソースコードをコーディング規約に合わせるようにしています。RuboCopはRubyのソースコードを静的解析し、コーディング規約に合っていない箇所を指摘してくれるツールです。コーディング規約はあっても実際には守られないという現実は多くありますので、ツールを使ってコーディング規約を守ろうという寸法です。
RuboCopでベース">
<meta property="og:type" content="website">
<meta property="og:title" content="RuboCopを使ってコーディング規約に沿ったコードを書く">
<meta property="og:url" content="http://blog.mmmcorp.co.jp/blog/2014/05/09/shimojo/index.html">
<meta property="og:site_name" content="MMMブログ">
<meta property="og:description" content="下條です。現在参加しているRailsプロジェクトでは、RuboCopを使ってソースコードをコーディング規約に合わせるようにしています。RuboCopはRubyのソースコードを静的解析し、コーディング規約に合っていない箇所を指摘してくれるツールです。コーディング規約はあっても実際には守られないという現実は多くありますので、ツールを使ってコーディング規約を守ろうという寸法です。
RuboCopでベース">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="RuboCopを使ってコーディング規約に沿ったコードを書く">
<meta name="twitter:description" content="下條です。現在参加しているRailsプロジェクトでは、RuboCopを使ってソースコードをコーディング規約に合わせるようにしています。RuboCopはRubyのソースコードを静的解析し、コーディング規約に合っていない箇所を指摘してくれるツールです。コーディング規約はあっても実際には守られないという現実は多くありますので、ツールを使ってコーディング規約を守ろうという寸法です。
RuboCopでベース">
  
    <link rel="alternative" href="http://feeds.feedburner.com/xxxxxly" title="MMMブログ" type="application/atom+xml">
  
  
    <link rel="icon" href="favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <link rel="stylesheet" href="/css/custom-mnmlpress.css" type="text/css">
  

</head>

<header id="header" class="inner">
  <h1>
    <a href="/" id="logo">MMMブログ</a>
  </h1>
  
</div>
</header>
<body>
  <div id="content" class="inner">
        <article id="post-shimojo" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <time datetime="2014-05-09T07:19:06.000Z" itemprop="datePublished">2014-05-09</time>
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
    <h3 itemprop="name">
      <a class="article-title" href="/blog/2014/05/09/shimojo/">RuboCopを使ってコーディング規約に沿ったコードを書く</a>
    </h3>
  
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>下條です。<br>現在参加しているRailsプロジェクトでは、RuboCopを使ってソースコードをコーディング規約に合わせるようにしています。RuboCopはRubyのソースコードを静的解析し、コーディング規約に合っていない箇所を指摘してくれるツールです。コーディング規約はあっても実際には守られないという現実は多くありますので、ツールを使ってコーディング規約を守ろうという寸法です。</p>
<p>RuboCopでベースとしているコーディング規約自体は<a href="https://github.com/bbatsov/ruby-style-guide" target="_blank" rel="external">これ</a>です。<br>また、<a href="https://github.com/fortissimo1997/ruby-style-guide/blob/japanese/README.ja.md" target="_blank" rel="external">日本語訳</a>をしてくれている方もいます。</p>
<h2 id="インストール">インストール</h2><p>インストールはこれだけです。</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gem <span class="keyword">install</span> rubocop</span><br></pre></td></tr></table></figure>
<h2 id="使用方法">使用方法</h2><p>カレントディレクトリ配下のRubyソースを全てチェックしてくれます。</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>rubocop</span><br></pre></td></tr></table></figure>
<p>ファイル指定やディレクトリ指定も可能です。</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>rubocop hoge.rb</span><br><span class="line"><span class="variable">$ </span>rubocop hoge</span><br></pre></td></tr></table></figure>
<h2 id="vimとの連携">vimとの連携</h2><p>RuboCopと各種エディタの連携が可能です。<br>vimユーザは<a href="https://github.com/ngmy/vim-rubocop" target="_blank" rel="external">Vim RuboCop</a>が使用可能です。</p>
<p>個人的には、ついついRuboCopを通し忘れるのがいやなので、自動的に通すようにしてあります。syntasticを使います。<br>syntasticをインストールした上で、以下を.vimrcに追加。</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attribute">g</span>:syntastic_mode_map = &#123; <span class="string">'mode'</span>: <span class="string">'active'</span>,</span><br><span class="line">            <span class="string">\</span> <span class="string">'active_filetypes'</span>: [<span class="string">'ruby'</span>] &#125;</span><br><span class="line"><span class="keyword">let</span> <span class="attribute">g</span>:syntastic_ruby_checkers = [<span class="string">'rubocop'</span>]</span><br></pre></td></tr></table></figure>
<p>これで、保存のたびにRuboCopが走るようになります。保存が多少重くなりますが、ソースを書いてから流すよりもベターかなと思います。テストまで通してから、RuboCop通すの忘れたことに気づいて、対応してからまたテストするのは時間がもったいないので。</p>
<h2 id="コーディング規約の変更">コーディング規約の変更</h2><p>個人的感想としては、最初にRuboCopを使ったときは、チェックがけっこう厳しいなあという印象でした。あと、たまに何を指摘されているのかわからないこともありました。<br>特に、これまでソースコードの1行80文字制限を気にしたことがなかったことが多いのですが、参加したプロジェクトでは1行80文字制限があり、慣れるまでちょっと苦労しました。  </p>
<p>まあ慣れたら大したことはないのですし、次第にコーディング規約が頭に入ってくるのでRuboCopの指摘が入ることも少なくなってきます。<br>ただ、メソッド一つ10行とかちょっときついルールもあるので、適宜.rubocop.ymlファイルで設定を変更していくのが良いと思います。</p>
<h2 id="ためしに">ためしに</h2><p>RuboCop自体のソースコードをRuboCopにかけてみました。全部完璧に通っています。さすが！</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/Users/shimojomasatsugu/Development/rubocop<span class="subst">%</span> rubocop</span><br><span class="line">Inspecting <span class="number">469</span> files</span><br><span class="line"><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="built_in">.</span><br><span class="line"></span><br><span class="line"></span><span class="number">469</span> files inspected, no offenses detected</span><br></pre></td></tr></table></figure>
<p>と思ったら、、、.rubocop_todo.ymlで設定を変更していました。</p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">（前略）</span><br><span class="line"><span class="preprocessor"># Offense count: 24</span></span><br><span class="line">CyclomaticComplexity:</span><br><span class="line">  Max: <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># Offense count: 114</span></span><br><span class="line"><span class="preprocessor"># Configuration parameters: CountComments.</span></span><br><span class="line">MethodLength:</span><br><span class="line">  Max: <span class="number">20</span></span><br></pre></td></tr></table></figure>
<p>あれ、本家がこれをやるのは反則では・・・  </p>
<p>と思う気持ちは置いておいて、デフォルトではCyclomaticComplexityは6、MethodLengthは10になっていますが、個人的にもちょっと厳しいのではと思っていました。まあ納得です。</p>
<p>なお、最近、<br><a href="https://www.sideci.com/" target="_blank" rel="external">SideCI</a><br>というサービスが登場しました。これも静的解析ツールですが、Railsのソースを対象に、Railsらしくないコードや、セキュリティに問題があるコードなどをチェックしてくれるということで気になっています。またレポートできればと思います。</p>

      
    </div>
    <footer class="article-footer">
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Ruby/">Ruby</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/開発ツール/">開発ツール"</a></li></ul>


      <p class="article-footer__author">by 下條 真嗣</p>
    </footer>
  </div>
</article>



        <hr class="footer-line">
  </div>
<footer id="footer" class="inner">
  <div id="footer-info">
    &copy;2015 <a href="http://mmmcorp.co.jp/" target="_blank" class="footer_info__author">株式会社MMM</a>
  </div>
</footer>



<script src="//code.jquery.com/jquery-2.1.1.min.js"></script>


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js" type="text/javascript"></script>
</body>
</html>
